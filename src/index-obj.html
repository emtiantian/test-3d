<!DOCTYPE html>
<html lang="en">

<head>
  <title>three.js webgl - loaders - OBJ loader</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0" />
  <style>
    body {
      font-family: Monospace;
      background-color: #000;
      color: #fff;
      margin: 0px;
      overflow: hidden;
    }

    #info {
      color: #fff;
      position: absolute;
      top: 10px;
      width: 100%;
      text-align: center;
      z-index: 100;
      display: block;
    }

    #info a,
    .button {
      color: #f00;
      font-weight: bold;
      text-decoration: underline;
      cursor: pointer;
    }
  </style>
</head>

<body>
  <script src="./js/three.js"></script>
  <script src="./js/OrbitControls.js"></script>
  <script src="./js/OBJLoader.js"></script>
  <script src="./js/MTLLoader.js"></script>


  <script>

    var container
    var camera, scene, renderer
    var mouseX = 0,
      mouseY = 0
    var windowHalfX = window.innerWidth / 2
    var windowHalfY = window.innerHeight / 2
    var object
    var clock = new THREE.Clock()
    init()
    animate()

    function init() {
      container = document.createElement('div')
      document.body.appendChild(container)
      // 摄像头
      camera = new THREE.PerspectiveCamera(
        45,
        window.innerWidth / window.innerHeight,
        1,
        100000
      )
      camera.position.x = -4000
      camera.position.y = 4000
      camera.position.z = 40000
      // 场景
      scene = new THREE.Scene()
      // 基础光源
      var ambientLight = new THREE.AmbientLight(0xcccccc, 0.1)
      scene.add(ambientLight)
      // 加载点光源
      var pointLight = new THREE.PointLight(0xffffff, 0.05)
      pointLight.position.set(0,10000,0);
      camera.add(pointLight)
      // 自然光源
      var hemiLight = new THREE.HemisphereLight(0xffffff, 0xa4a7a8,0.8)
      hemiLight.position.set(0,10000,0);
      // 加载自然光
      scene.add(hemiLight)

      // 加载场景
      scene.add(camera)

      function onError() {}
      // 加载材质及模型
      new THREE.MTLLoader()
        .setPath('./assets/')
        .load('1.mtl', function (materials) {
          materials.preload()
          new THREE.OBJLoader()
            .setMaterials(materials)
            .setPath('./assets/')
            .load(
              '1.obj',
              function (object) {
                scene.add(object)
              },
              onProgress,
              onError
            )
        })

      // 加载进度
      function onProgress(xhr) {
        if (xhr.lengthComputable) {
          var percentComplete = (xhr.loaded / xhr.total) * 100
          console.log(
            'model ' + Math.round(percentComplete, 2) + '% downloaded'
          )
        }
      }

      renderer = new THREE.WebGLRenderer()
      renderer.setPixelRatio(window.devicePixelRatio)
      renderer.setSize(window.innerWidth, window.innerHeight)
      container.appendChild(renderer.domElement)
      controls = new THREE.OrbitControls(camera, renderer.domElement)
      controls.target.set(0, 0.5, 0)
      controls.enablePan = false
      window.addEventListener('resize', onWindowResize, false)
    }

    function onWindowResize() {
      windowHalfX = window.innerWidth / 2
      windowHalfY = window.innerHeight / 2
      camera.aspect = window.innerWidth / window.innerHeight
      camera.updateProjectionMatrix()
      renderer.setSize(window.innerWidth, window.innerHeight)
    }

    // 加入浏览器下次渲染
    function animate() {
      requestAnimationFrame(animate)
      render()
    }
    // 渲染
    function render() {
      var delta = clock.getDelta()
      controls.update(delta)
      renderer.render(scene, camera)
    }
  </script>
</body>

</html>